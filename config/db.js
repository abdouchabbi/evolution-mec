
// -----------------------------------------------------------------------------
// ملف إعدادات قاعدة البيانات (config/db.js)
// -----------------------------------------------------------------------------
// هذا الملف مسؤول عن مهمة واحدة فقط: الاتصال بقاعدة بيانات MongoDB.
// يتم استدعاء الدالة الموجودة في هذا الملف من الملف الرئيسي (server.js)
// لبدء الاتصال عند تشغيل الخادم.
// -----------------------------------------------------------------------------

// 1. استيراد مكتبة Mongoose
// -----------------------------------------------------------------------------
const mongoose = require('mongoose');

// 2. تعريف دالة الاتصال بقاعدة البيانات
// -----------------------------------------------------------------------------
const connectDB = async () => {
    try {
        // محاولة الاتصال باستخدام رابط الاتصال الموجود في ملف .env
        // mongoose.connect() تعيد Promise، لذلك نستخدم await لانتظار اكتمالها
        const conn = await mongoose.connect(process.env.MONGO_URI, {
            useNewUrlParser: true,
            useUnifiedTopology: true,
        });

        // طباعة رسالة نجاح في الكونسول مع عرض اسم المضيف (host) لقاعدة البيانات
        console.log(`تم الاتصال بقاعدة بيانات MongoDB بنجاح: ${conn.connection.host}`);
    } catch (error) {
        // في حال فشل الاتصال، يتم طباعة رسالة خطأ وإيقاف تشغيل الخادم
        console.error(`خطأ في الاتصال بقاعدة البيانات: ${error.message}`);
        process.exit(1); // إيقاف العملية مع رمز فشل
    }
};

// 3. تصدير دالة الاتصال (export)
// -----------------------------------------------------------------------------
// نقوم بتصدير الدالة connectDB حتى نتمكن من استيرادها واستخدامها في ملف server.js
module.exports = connectDB;
