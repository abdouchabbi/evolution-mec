
// -----------------------------------------------------------------------------
// ملف نموذج سجلات الدوام (models/timesheet.model.js)
// -----------------------------------------------------------------------------
// هذا الملف يعرف "هيكل" (Schema) بيانات سجلات الدوام اليومية.
// إنه يمثل قلب النظام، حيث يسجل كل حركة دخول وخروج للموظف،
// ويربطها باليوم والمشروع.
// -----------------------------------------------------------------------------

// 1. استيراد مكتبة Mongoose
// -----------------------------------------------------------------------------
const mongoose = require('mongoose');

// 2. تعريف هيكل بيانات سجلات الدوام (TimesheetSchema)
// -----------------------------------------------------------------------------
const TimesheetSchema = new mongoose.Schema({
    // حقل لربط السجل بالموظف
    employeeName: {
        type: String,
        required: true,
        uppercase: true,
        trim: true
    },
    // حقل لتحديد تاريخ هذا السجل
    date: {
        type: String, // سيتم تخزينه بصيغة 'YYYY-MM-DD' لسهولة البحث
        required: true
    },
    // حقل لتحديد المشروع الذي تم العمل عليه في هذا اليوم
    project: {
        type: String,
        trim: true
    },
    // حقل لوصف المهام التي تم إنجازها
    description: {
        type: String,
        trim: true
    },
    // حقل لتخزين جميع تسجيلات الدخول والخروج لهذا اليوم
    entries: [{
        // نوع التسجيل: دخول أو خروج
        type: {
            type: String,
            enum: ['check-in', 'check-out'], // القيم المسموح بها فقط
            required: true
        },
        // وقت التسجيل
        time: {
            type: String, // سيتم تخزينه بصيغة 'HH:MM'
            required: true
        },
        // موقع التسجيل الجغرافي (GPS)
        location: {
            lat: Number,
            lon: Number
        }
    }],
    // حقل لتخزين إجمالي ساعات العمل المحسوبة لهذا اليوم
    totalHours: {
        type: Number,
        default: 0
    }
});

// 3. إنشاء فهرس مركب (Compound Index)
// -----------------------------------------------------------------------------
// هذا الفهرس يضمن أنه لا يمكن أن يكون هناك أكثر من سجل واحد لنفس الموظف
// في نفس اليوم، مما يمنع تكرار البيانات ويحافظ على سلامتها.
TimesheetSchema.index({ employeeName: 1, date: 1 }, { unique: true });

// 4. تصدير النموذج (Model)
// -----------------------------------------------------------------------------
module.exports = mongoose.model('Timesheet', TimesheetSchema);
